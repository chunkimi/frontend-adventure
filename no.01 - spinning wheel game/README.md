# spinning wheel game
抽獎遊戲，通過點擊按鈕來旋轉指針，從而隨機選擇獎品。遊戲可以在不同模式下運行，根據選擇不同的獎品池（如「presents」和「envelopes」模式），玩家有固定的抽獎次數，並且每次遊戲後，獎品數量會隨之減少。

## 關鍵重點
- `transform: rotate` : 透過這個 CSS 屬性，能夠讓 DOM 元素（如指針）進行旋轉。此屬性根據指定的角度來改變元素的方向，從而實現抽獎輪盤的轉動效果。
  
- `transition` : 控制動畫的過渡效果，使旋轉動畫更平滑。使用 `ease-in-out` 過渡效果可以模擬物理運動，使旋轉開始和結束時速度較慢，中間速度加快。

- `document.querySelector` 和 `document.querySelectorAll` : 用來選取頁面中的相關 DOM 元素（如輪盤、指針、按鈕），並透過 JavaScript 操作這些元素來實現動態效果。

- `Math.random()` : 用於生成隨機數來決定抽中哪一個獎品。這是實現隨機抽獎的核心部分，確保每次抽獎的結果都是隨機的。

- `inWheelLoading` : 遊戲中的布林變量，用來防止玩家在指針旋轉時重複點擊抽獎按鈕。當指針旋轉時，設置為 `true`，旋轉完成後重置為 `false`。

- `init` : 初始化遊戲邏輯，根據所選模式（如禮物或紅包模式）重繪轉盤和獎品清單，並重置獎品數量和抽獎次數。

- `loadingSpins` : 預設指針選轉圈數

- `spinDegree` : 計算指針的最終旋轉角度，由具體獎品的角度和預設指針選轉圈數數組成。這使指針能多轉幾圈後才停在目標獎品上，增加真實性。


## 需求
通過點擊按鈕來旋轉指針，從而隨機選擇獎品。遊戲可以在不同模式下運行，根據選擇不同的獎品池（如「presents」和「envelopes」模式），玩家有固定的抽獎次數，並且每次遊戲後，獎品數量會隨之減少。

### 抽獎機制
- 雙重抽獎： 包含獎品抽獎和紅包抽獎。
- 獎品種類： 獎品共 8 種，紅包金額有 20 種。
- 轉盤抽獎： 點擊「PRESS」按鈕後，指針隨機指向一個獎品。
- 獎品數量扣除： 每抽中一個獎品，對應的獎品數量減 1。
- 中獎資訊顯示： 中獎後顯示中獎編號和獎品名稱。
- 重置功能： 點擊「Reset」按鈕後，所有獎品數量恢復初始值。
- 獎品數量限制： 獎品數量為 0 時，該獎品不會被抽中。
- Banner 顯示： 只有在抽獎結果確定後才顯示中獎資訊 Banner。
- 抽獎限制： 當所有獎品都被抽完時，點擊「PRESS」按鈕無效。

### 系統功能
- 切換模式： 點選Button「Presents」或 「Envelopes」，切換抽獎品還是抽紅包。
- 使用者互動： 使用者透過點擊「PRESS」按鈕觸發抽獎，點擊「Reset」按鈕重置抽獎狀態。
- 獎品機制： 系統根據設定的獎品數量和機率，隨機選取一個獎品。
- 畫面更新： 系統會即時更新獎品數量、顯示中獎資訊和轉盤狀態。

### 本次需要完成的功能
- 抽獎功能：透過點擊按鈕來旋轉指針，，從而隨機選擇獎品。
- 切換模式功能：「禮物模式」和「紅包模式」
- 重置功能：點擊 Reset 按鈕後所有品項數量初始化。
- 抽獎指針轉動，指向抽中的獎品。
- 每次抽獎中獎品後才顯示 banner 資訊（轉動過程不顯示）。
- 最後一個獎品抽完時後，點擊 press 不會轉動。
- 獎品數量為 0 時，該獎品之後不會再被選到。



## 步驟拆解
- 1. DOM 元素選取：通過 `document.querySelector` 和 `document.querySelectorAll` 來選取頁面中的相關元素，如輪盤、指針、按鈕和獎品列表等。這些 DOM 元素將在後續的遊戲邏輯中被操作和修改。

- 2. 預設數據與設定：程式碼中定義了兩個遊戲模式：「presents」和「envelopes」，每個模式都有其各自的獎品數據與抽獎次數。這些數據會在初始化時被複製到遊戲進行中的數據對象中，以便在遊戲過程中修改獎品數量和抽獎次數。

- 3. 初始化遊戲：`init` 函數會根據所選擇的模式，初始化遊戲數據，重設所有相關的 UI 元素（如獎品板、指針位置），並重繪輪盤。每次切換遊戲模式或重新開始遊戲時，該函數都會被調用。

- 4. 隨機抽獎邏輯：當玩家點擊「開始」按鈕時，`randomWheel` 函數會隨機選取一個尚未抽中的獎品，並計算該獎品在輪盤上的角度。接著，指針會旋轉到對應的角度，模擬抽獎過程。遊戲會等待旋轉動畫結束後，顯示抽中的獎品並減少其數量。

- 5. 渲染指針：`renderPointer` 函數負責旋轉指針，計算指針應該旋轉的角度（包含完整旋轉的圈數）。

- 6. 清理指針旋轉的過渡效果：當指針旋轉結束後，`clearPointerTransition` 會清理過渡動畫，並將指針的角度重設為最終結果的角度，避免下一次旋轉時出現錯誤。

- 7. 顯示抽獎結果：`renderRewardBoard` 函數會在抽獎結束後顯示獎品信息，更新獎品板上所抽中的獎品名稱和遊戲次數。

- 8. 遊戲模式切換：通過點擊按鈕，玩家可以在「presents」和「envelopes」兩個模式之間切換。切換時會重新初始化輪盤和數據，並將 UI 元素更新為對應模式的顯示狀態。

- 9. 重置遊戲：`handleReset` 函數允許玩家在遊戲中途重置遊戲數據並重新開始。此操作會重新初始化當前模式的數據，並將輪盤和獎品數量恢復到初始狀態。

- 10. 防止多次抽獎：為了避免玩家在指針尚未停止旋轉時再次抽獎，設置了 `inWheelLoading` 標誌，當該標誌為 `true` 時，會彈出提示並阻止重複操作。


## 樣式改動
- `.selectors`的`z-index`調高，不然 `#wheel`和`.icon-group`添加`new`時，容易遮擋選單，無法點選RESET

## 指針旋轉
旋轉效果的邏輯是利用 CSS `transform: rotate` 屬性來改變 DOM 元素的角度，並通過 `transition` 來控制動畫的流暢性。通過旋轉多圈的設計，模擬了現實中抽獎轉盤的效果，使得遊戲體驗更加自然與逼真。
- 1. **`spinDegree` 的計算**
   - `spinDegree` 是指針應該旋轉的最終角度，由以下兩部分組成：
     - `pointerDegree`：這是指針應該指向的具體獎品對應的角度。
     - `360 * loadingSpins`：這個值代表了指針旋轉幾圈的額外度數，讓旋轉看起來更真實。這裡 `loadingSpins` 設定為 `3`，表示指針會多轉三圈，然後停在指定的獎品位置。
   
   公式：
   ```javascript
   const spinDegree = pointerDegree + 360 * loadingSpins;
   ```

- 2. **`pointer.style.transform` 的應用**
   - 使用 `pointer.style.transform` 來應用旋轉效果。`transform: rotate(${spinDegree}deg)` 將指針按計算的 `spinDegree` 角度進行旋轉。
   
   具體代碼：
   ```javascript
   pointer.style.transform = `rotate(${spinDegree}deg)`;
   ```

   這行代碼會告訴瀏覽器將 `pointer` 元素（指針）順時針旋轉 `spinDegree` 度數。

- 3. **`pointer.style.transition` 的應用**
   - 為了讓旋轉效果更平滑，使用 `pointer.style.transition` 屬性來控制旋轉動畫的速度和曲線。這裡使用了 `all 1s ease-in-out`，表示動畫會在 1 秒內完成，並且動畫速度是逐漸加速和減速的效果（`ease-in-out`）。
   
   具體代碼：
   ```javascript
   pointer.style.transition = `all 1s ease-in-out`;
   ```

   - `all` 表示將動畫應用於所有可以過渡的 CSS 屬性。
   - `1s` 是動畫持續時間，設為 1 秒。
   - `ease-in-out` 是一種過渡效果，它在開始和結束時速度較慢，中間速度較快，能模擬物理上更自然的運動效果。

- 4. **動畫完成後重置指針**
   - 當指針完成旋轉後，應將 `transition` 清除，並將指針的角度重設為最終的獎品位置，避免下一次旋轉時發生異常（如指針突然跳動）。
   
   這是在 `clearPointerTransition` 函數中實現的：
   ```javascript
   pointer.style.transition = '';
   pointer.style.transform = `rotate(${pointerDegree}deg)`;
   ```

#### 常見問題排查
- **指針無法旋轉**：確認 `spinDegree` 計算是否正確，並檢查 `pointer.style.transform` 是否被正確應用。
- **動畫效果不平滑**：檢查 `pointer.style.transition` 的屬性值，確保時間和過渡曲線設置合理。